<div class="analytics-container">
  <h1>Statistiken</h1>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Lade Statistiken...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="!loading && !error" class="analytics-content">
    
    <!-- Order Statistics Cards -->
    <div class="stats-cards">
      <!-- Daily Orders Card -->
      <mat-card class="stat-card" *ngIf="dailyAnalytics">
        <mat-card-header>
          <mat-icon mat-card-avatar>today</mat-icon>
          <mat-card-title>Bestellungen heute</mat-card-title>
          <mat-card-subtitle>{{ formatDate(dailyAnalytics.date) }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ dailyAnalytics.orderCount }}</div>
          <div class="stat-label">Bestellungen</div>
        </mat-card-content>
      </mat-card>

      <!-- Weekly Orders Card -->
      <mat-card class="stat-card" *ngIf="weeklyAnalytics">
        <mat-card-header>
          <mat-icon mat-card-avatar>date_range</mat-icon>
          <mat-card-title>Bestellungen diese Woche</mat-card-title>
          <mat-card-subtitle>{{ formatWeekRange() }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ weeklyAnalytics.orderCount }}</div>
          <div class="stat-label">Bestellungen</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Top Dishes Table -->
    <mat-card class="top-dishes-card" *ngIf="topDishes">
      <mat-card-header>
        <mat-icon mat-card-avatar>restaurant</mat-icon>
        <mat-card-title>Meist bestellte Gerichte</mat-card-title>
        <mat-card-subtitle>Alle Bestellungen</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <!-- No Data Message -->
        <div *ngIf="topDishes.dishes.length === 0" class="no-data">
          <mat-icon>info</mat-icon>
          <p>Noch keine Daten für diesen Zeitraum verfügbar</p>
        </div>

        <!-- Dishes Table -->
        <table mat-table [dataSource]="topDishes.dishes" *ngIf="topDishes.dishes.length > 0" class="dishes-table">
          
          <!-- Rank Column -->
          <ng-container matColumnDef="rank">
            <th mat-header-cell *matHeaderCellDef> Rang </th>
            <td mat-cell *matCellDef="let dish; let i = index">
              <span class="rank" [class.top-three]="i < 3">
                <mat-icon *ngIf="i === 0" class="medal gold">emoji_events</mat-icon>
                <mat-icon *ngIf="i === 1" class="medal silver">emoji_events</mat-icon>
                <mat-icon *ngIf="i === 2" class="medal bronze">emoji_events</mat-icon>
                <span *ngIf="i > 2">{{ i + 1 }}</span>
              </span>
            </td>
          </ng-container>

          <!-- Dish Name Column -->
          <ng-container matColumnDef="dishName">
            <th mat-header-cell *matHeaderCellDef> Gericht </th>
            <td mat-cell *matCellDef="let dish"> {{ dish.dishName }} </td>
          </ng-container>

          <!-- Order Count Column -->
          <ng-container matColumnDef="orderCount">
            <th mat-header-cell *matHeaderCellDef> Anzahl Bestellungen </th>
            <td mat-cell *matCellDef="let dish"> {{ dish.orderCount }} </td>
          </ng-container>

          <!-- Total Quantity Column -->
          <ng-container matColumnDef="totalQuantity">
            <th mat-header-cell *matHeaderCellDef> Gesamtmenge </th>
            <td mat-cell *matCellDef="let dish"> {{ dish.totalQuantity }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>

  </div>
</div>
